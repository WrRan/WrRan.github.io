<!DOCTYPE html><html class="theme-next muse use-motion" lang="zh-Hans"><head><meta name="generator" content="Hexo 3.9.0"><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1"><meta name="theme-color" content="#222"><link rel="stylesheet" media="all" href="/lib/Han/dist/han.min.css?v=3.3"><meta http-equiv="Cache-Control" content="no-transform"><meta http-equiv="Cache-Control" content="no-siteapp"><meta name="baidu-site-verification" content="1SzRDU50sB"><link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css"><link href="//fonts.googleapis.com/css?family=Lato:300,300italic,400,400italic,700,700italic&subset=latin,latin-ext" rel="stylesheet" type="text/css"><link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css"><link href="/css/main.css?v=5.1.2" rel="stylesheet" type="text/css"><meta name="keywords" content="WrRan, AI, NLP, software engineering"><link rel="alternate" href="/atom.xml" title="WrRan の 杂货铺" type="application/atom+xml"><link rel="shortcut icon" type="image/x-icon" href="/favicon.ico?v=5.1.2"><meta name="description" content="临阵磨枪，不快也光是时候，来一波学习的小高潮了 ;)"><meta property="og:type" content="article"><meta property="og:title" content="中间件复习"><meta property="og:url" content="http://47.110.235.226/blog/2016/06/06/review/middleware/index.html"><meta property="og:site_name" content="WrRan の 杂货铺"><meta property="og:description" content="临阵磨枪，不快也光是时候，来一波学习的小高潮了 ;)"><meta property="og:locale" content="zh-Hans"><meta property="og:image" content="https://upload.wikimedia.org/wikipedia/commons/7/7b/RM-ODP_viewpoints.jpg"><meta property="og:image" content="http://7xuthx.com1.z0.glb.clouddn.com/review-middleware%2Fimage%2FOMA%E5%8F%82%E8%80%83%E6%A8%A1%E5%9E%8B.png"><meta property="og:image" content="http://7xuthx.com1.z0.glb.clouddn.com/review-middleware%2Fimage%2FCORBA%E4%B8%BB%E8%A6%81%E5%86%85%E5%AE%B9.png"><meta property="og:image" content="http://7xuthx.com1.z0.glb.clouddn.com/image%2Freview-middleware%2FRMI%E5%AE%9E%E7%8E%B0%E6%A8%A1%E5%9E%8B.png"><meta property="og:image" content="http://7xuthx.com1.z0.glb.clouddn.com/image%2Freview-middleware%2FRMI%E6%89%A7%E8%A1%8C%E6%A8%A1%E5%9E%8B.png"><meta property="og:image" content="http://7xuthx.com1.z0.glb.clouddn.com/image/review-middleware/RMI%E9%80%9A%E4%BF%A1%E6%A8%A1%E5%9E%8B.png"><meta property="og:image" content="http://7xuthx.com1.z0.glb.clouddn.com/image/review-middleware/JavaEE7%E7%9A%84%E6%9E%B6%E6%9E%84.png"><meta property="og:image" content="http://7xuthx.com1.z0.glb.clouddn.com/image/review-middleware/EJB%E7%BC%96%E7%A8%8B%E6%A1%86%E6%9E%B6.png"><meta property="og:image" content="http://7xuthx.com1.z0.glb.clouddn.com/image/review-middleware/AOP%E7%9A%84%E7%BB%84%E6%88%90%E9%83%A8%E5%88%86.png"><meta property="og:image" content="http://7xuthx.com1.z0.glb.clouddn.com/image/review-middleware/%E7%82%B9%E5%AF%B9%E7%82%B9-%E6%B6%88%E6%81%AF%E4%B8%AD%E9%97%B4%E4%BB%B6%E6%9E%B6%E6%9E%84.png"><meta property="og:image" content="http://7xuthx.com1.z0.glb.clouddn.com/image/review-middleware/%E8%AE%A2%E9%98%85%E5%8F%91%E5%B8%83-%E6%B6%88%E6%81%AF%E4%B8%AD%E9%97%B4%E4%BB%B6%E6%9E%B6%E6%9E%84.png"><meta property="og:image" content="http://7xuthx.com1.z0.glb.clouddn.com/image/review-middleware/ODBC%E4%BD%93%E7%B3%BB%E6%9E%B6%E6%9E%84.PNG"><meta property="og:image" content="http://7xuthx.com1.z0.glb.clouddn.com/image/review-middleware/OLEDB%E4%BD%93%E7%B3%BB%E6%9E%B6%E6%9E%84.PNG"><meta property="og:image" content="http://7xuthx.com1.z0.glb.clouddn.com/image/review-middleware/ODBC_OLEDB_ADO%E5%85%B3%E7%B3%BB%E5%9B%BE.PNG"><meta property="og:image" content="http://7xuthx.com1.z0.glb.clouddn.com/image/review-middleware/Hibernate%E6%89%80%E6%89%AE%E6%BC%94%E7%9A%84%E8%A7%92%E8%89%B2.PNG"><meta property="og:image" content="http://7xuthx.com1.z0.glb.clouddn.com/image%2Freview-middleware%2F%E4%B8%A4%E9%98%B6%E6%AE%B5%E6%8F%90%E4%BA%A4%E5%8D%8F%E8%AE%AE.PNG"><meta property="og:image" content="http://7xuthx.com1.z0.glb.clouddn.com/image%2Freview-middleware%2FWeb%20Service%E7%9A%84%E4%BD%93%E7%B3%BB%E7%BB%93%E6%9E%84.PNG"><meta property="og:image" content="http://7xuthx.com1.z0.glb.clouddn.com/image%2Freview-middleware%2FUDDI%E3%80%81WSDL%E5%92%8CSOAP%E7%9A%84%E5%85%B3%E7%B3%BB.PNG"><meta property="og:updated_time" content="2019-08-15T19:59:16.518Z"><meta name="twitter:card" content="summary"><meta name="twitter:title" content="中间件复习"><meta name="twitter:description" content="临阵磨枪，不快也光是时候，来一波学习的小高潮了 ;)"><meta name="twitter:image" content="https://upload.wikimedia.org/wikipedia/commons/7/7b/RM-ODP_viewpoints.jpg"><script type="text/javascript" id="hexo.configurations">var NexT=window.NexT||{},CONFIG={root:"/",scheme:"Muse",sidebar:{position:"left",display:"post",offset:12,offset_float:12,b2t:!1,scrollpercent:!0,onmobile:!1},fancybox:!0,tabs:!0,motion:!0,duoshuo:{userId:"0",author:"博主"},algolia:{applicationID:"",apiKey:"",indexName:"",hits:{per_page:10},labels:{input_placeholder:"Search for Posts",hits_empty:"We didn't find any results for the search: ${query}",hits_stats:"${hits} results found in ${time} ms"}}}</script><link rel="canonical" href="http://47.110.235.226/blog/2016/06/06/review/middleware/"><title>中间件复习 | WrRan の 杂货铺</title><script type="text/javascript">var _hmt=_hmt||[];!function(){var e=document.createElement("script");e.src="https://hm.baidu.com/hm.js?6d4f6172d2d7b5703b9c1560a5af22a5";var t=document.getElementsByTagName("script")[0];t.parentNode.insertBefore(e,t)}()</script></head><body itemscope itemtype="http://schema.org/WebPage" lang="zh-Hans"><div class="container sidebar-position-left page-post-detail"><div class="headband"></div><header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader"><div class="header-inner"><div class="site-brand-wrapper"><div class="site-meta"><div class="custom-logo-site-title"><a href="/" class="brand" rel="start"><span class="logo-line-before"><i></i></span> <span class="site-title">WrRan の 杂货铺</span> <span class="logo-line-after"><i></i></span></a></div><h1 class="site-subtitle" itemprop="description"></h1></div><div class="site-nav-toggle"><button><span class="btn-bar"></span> <span class="btn-bar"></span> <span class="btn-bar"></span></button></div></div><nav class="site-nav"><ul id="menu" class="menu"><li class="menu-item menu-item-home"><a href="/" rel="section"><i class="menu-item-icon fa fa-fw fa-home"></i><br>首页</a></li><li class="menu-item menu-item-categories"><a href="/categories" rel="section"><i class="menu-item-icon fa fa-fw fa-th"></i><br>分类</a></li><li class="menu-item menu-item-about"><a href="/about" rel="section"><i class="menu-item-icon fa fa-fw fa-user"></i><br>关于</a></li><li class="menu-item menu-item-archives"><a href="/archives" rel="section"><i class="menu-item-icon fa fa-fw fa-archive"></i><br>归档</a></li><li class="menu-item menu-item-tags"><a href="/tags" rel="section"><i class="menu-item-icon fa fa-fw fa-tags"></i><br>标签</a></li><li class="menu-item menu-item-search"><a href="javascript:;" class="popup-trigger"><i class="menu-item-icon fa fa-search fa-fw"></i><br>搜索</a></li></ul><div class="site-search"><div class="popup search-popup local-search-popup"><div class="local-search-header clearfix"><span class="search-icon"><i class="fa fa-search"></i> </span><span class="popup-btn-close"><i class="fa fa-times-circle"></i></span><div class="local-search-input-wrapper"><input autocomplete="off" placeholder="搜索..." spellcheck="false" type="text" id="local-search-input"></div></div><div id="local-search-result"></div></div></div></nav></div></header><main id="main" class="main"><div class="main-inner"><div class="content-wrap"><div id="content" class="content"><div id="posts" class="posts-expand"><article class="post post-type-normal" itemscope itemtype="http://schema.org/Article"><div class="post-block"><link itemprop="mainEntityOfPage" href="http://47.110.235.226/blog/2016/06/06/review/middleware/"><span hidden itemprop="author" itemscope itemtype="http://schema.org/Person"><meta itemprop="name" content="WrRan"><meta itemprop="description" content><meta itemprop="image" content="/images/avatar.jpg"></span><span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization"><meta itemprop="name" content="WrRan の 杂货铺"></span><header class="post-header"><h2 class="post-title" itemprop="name headline">中间件复习</h2><div class="post-meta"><span class="post-time"><span class="post-meta-item-icon"><i class="fa fa-calendar-o"></i> </span><time title="创建于" itemprop="dateCreated datePublished" datetime="2016-06-06T02:17:14+08:00">2016-06-06 </time></span><span class="post-category"><span class="post-meta-divider">|</span> <span class="post-meta-item-icon"><i class="fa fa-folder-o"></i> </span><span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/review/" itemprop="url" rel="index"><span itemprop="name">review</span> </a></span></span><span class="post-meta-divider">|</span> <span class="page-pv"><i class="fa fa-file-o"></i> <span class="busuanzi-value" id="busuanzi_value_page_pv"></span> </span><span class="post-meta-divider">|</span><div class="post-wordcount"><span class="post-meta-item-icon"><i class="fa fa-file-word-o"></i> </span><span title="字数统计">10,335</span></div></div></header><div class="post-body han-init-context" itemprop="articleBody"><blockquote><p>临阵磨枪，不快也光</p></blockquote><p>是时候，来一波学习的小高潮了 ;)</p><a id="more"></a><h2 id="复习要点"><a href="#复习要点" class="headerlink" title="复习要点"></a>复习要点</h2><ul><li>CH1：总的介绍了全书的概念，要好好梳理一遍</li><li>CH2：分布式DCE框图，有哪些服务，解决哪些问题；RPC、处理什么、解决什么问题等</li><li>CH3：ODP - 全名+理解+透明度，CORBA：处理什么问题， 定义，跨平台；RPC、RMI、Web Service与CORBA的关联；CORBA框图，对象的操作（与RPC的不同）</li><li>CH4：RPC是怎样调用，与Web Service和CORBA有何不同；RMI不用太看</li><li>CH5：COM组件：定义、特点、接口怎么做（为什么有Unknown这个接口？）</li><li>CH6：概念：反射、注解、依赖注入、AOP；J2EE模块，JMS、JPA、MVC等</li><li>CH7：消息中间件：为了解决什么问题？解耦合（怎么达到这个目标？）多种方式</li><li>CH8：数据存取中间件ODBC、JDBC及两者差异，JPA vs Hibernate 为什么需要ORM</li><li>CH9：事务概念：分布式+普通事务，两段式协议：投票机制、两阶段，JTA</li><li>CH10（重要）：与具体关系的脉络，两种方式（SOAP、RESTful），SOA（PPT上可能不够）；分布式下，如何实现互操作</li></ul><h2 id="考试题型"><a href="#考试题型" class="headerlink" title="考试题型"></a>考试题型</h2><ol><li>概念解释（4道）</li><li>简答题（8道）</li><li>综合题（2道）</li><li>开放设计题（1道）：大规模网上商城系统 类似京东淘宝 支持同时100000人在线 请分析基本功能模块 利用学到的知识给出可行的技术方案 说明模块和技术框架 可以考虑用云计算支持高并发 （负载均衡 集群）</li></ol><h2 id="REVIEW"><a href="#REVIEW" class="headerlink" title="REVIEW"></a>REVIEW</h2><h3 id="CH1-概述"><a href="#CH1-概述" class="headerlink" title="CH1 - 概述"></a>CH1 - 概述</h3><h4 id="中间件的背景及特点"><a href="#中间件的背景及特点" class="headerlink" title="中间件的背景及特点"></a>中间件的背景及特点</h4><p>中间件出现的<strong>背景</strong>：软件发展多年，没有考虑整合、兼容、互操作问题，这导致软件复用时需要考虑到不同的操作系统、程序语言、函数调用规范、编程模式；但新技术并不意味着推翻、抛弃已有的系统，而应当是集成旧系统，达到<strong>旧貌换新颜</strong>的功效。<br>现代应用系统的<strong>基本特征</strong>：</p><ol><li>分布：任务不只是在单击上运行，而是由网络中多个计算机上的相关应用共同协作完成，需要额外考虑网络传输、数据安全、数据一致性、同步等问题。</li><li>异构：计算机硬件、操作系统、网络协议、数据库系统及开发工具种类繁多，需要考虑数据表示、调用接口、处理方式等诸多问题。</li><li>动态协作：参与协作的应用允许位置透明性、迁移透明性、负载平衡性等需求。</li></ol><hr><h4 id="分布式系统"><a href="#分布式系统" class="headerlink" title="分布式系统"></a>分布式系统</h4><blockquote><p>A <code>Distributed System</code> is a omer in which components located on networked computers communicate and coordinate their actions by passing messages.[1] The components interact with each other in order to achieve a common goal. BY <a href="https://en.wikipedia.org/wiki/Distributed_computing" title="Wiki-Pedia" target="_blank" rel="noopener"><strong>Wikipedia</strong></a></p></blockquote><p>分布式系统设计中<strong>需要考虑的问题</strong>：</p><ol><li>透明性（对用户、程序而言）<ul><li>位置透明：用户无须知道资源位于何处</li><li>迁移透明：资源可以<strong>不改名</strong>的随意移动</li><li>复制透明：用户不知道是否存在多个备份</li><li>并发透明：多个用户可以自动的共享资源</li><li>并行透明：系统活动可以在用户没有感觉的情况下并行发生</li></ul></li><li>灵活性</li><li>可靠性: 可用性、安全性、容错性</li><li>性能：响应时间、吞吐量、系统的利用率、网络容量消耗程度、并行性（细粒度/粗粒度）</li><li>可伸缩性：避免集中式<strong>硬件</strong>，如单台服务器；避免集中式<strong>算法</strong>，如根据完整信息的网络路由；避免集中式<strong>数据结构</strong>，如单台数据库</li><li>可扩展性<ul><li>没有一台机器存放着关于系统状态的全部信息，机器只是基于本地信息作出决定</li><li>一个机器出故障不会破坏算法</li><li>不一定存在全局时钟</li></ul></li></ol><p>分布式系统常见的三层架构：</p><ul><li>客户机(Client)只负责简单的显示、捕获和验证用户数据，称为Thin Client</li><li>中间件(Middleware)支持客户机做复杂商务处理的服务器层，较为强大和灵敏</li><li>后台服务器(Server)管理持久性的业务数据，通常直接和数据库交换信息</li></ul><hr><h4 id="中间件"><a href="#中间件" class="headerlink" title="中间件"></a>中间件</h4><blockquote><p><code>Middleware</code> is computer software that provides services to software applications beyond those available from the operating system. It can be described as “software glue”. BY <a href="https://en.wikipedia.org/wiki/Middleware" title="Wikipedia" target="_blank" rel="noopener"><strong>Wikipedia</strong></a></p></blockquote><p><strong>中间件</strong>是一种软件，处于系统软件（操作系统和网络软件）与应用软件之间，能让应用软件之间进行<em>跨网络的协同操作</em>，允许各个应用软件所涉及的系统结构、操作系统、通信协议、数据库和其他应用服务等的差异。</p><p>中间件对于应用软件之间的协作工作表现在，提供了</p><ul><li>合作对象透明设施，应用软件节点只需要说明自己需要什么样的服务，而不用关心合作方是谁、在哪</li><li>下层设备透明设施，应用软件节点只需要说明关注自己的相关环境，而不必操心与之合作的其他节点与自身环境的差异<br>中间件的优点：</li></ul><ol><li>软件开发的重心从实现功能转移到功能的组合，降低了成本、提高了质量</li><li>软件功能的扩充可以在二进制级别下进行，让软件从封闭转化为开放【开闭原则】<br>之外，因为标准接口对于可移植性、标准协议及标准协议的重要性，<strong>中间件</strong>已成为许多标准化工作的主要部分。</li></ol><hr><h4 id="其他"><a href="#其他" class="headerlink" title="其他"></a>其他</h4><p>软件技术发展的<strong>四次飞跃</strong>：面向过程（Procedure-Oriented）=&gt;面向对象（Object-Oriented）=&gt;面向组件（Component-Oriented）=&gt;面向服务（Service-Oriented）<br>软件发展的源动力：最小化成本、最大化利益<br>软件发展的挑战：</p><ul><li>开发周期</li><li>开发成本</li><li>软件质量</li><li>系统可维护性</li><li>产品竞争</li><li>开发风险</li><li>资源的利用</li><li>资源的共享</li></ul><p>软件发展的机遇：</p><ul><li>Internet的普及</li><li>资源的共享 =&gt; 最大化收益、最小化成本、最快的开发速度</li></ul><p>软件危机的解决方案</p><ol><li>编程自动化：</li><li>实现程序的通用性：操作系统级，如汇编 =&gt; 与操作系统无关，如标准C =&gt; 与机器无关，如Java</li><li>实现软件之间的互操作：二进制级的软件互操作（同构软件/异构软件）=&gt; 同进程内互操作 =&gt; 不同进程间的互操作 =&gt; 不同机器间的互操作</li></ol><p>互操作</p><ol><li>组成：运行环境、开发工具、应用软件（客户软件、服务软件）</li><li>特性：分离性、透明性</li><li>范围<ul><li>同一进程，可以直接完成</li><li>不同进程</li><li>不同机器，要考虑data-encoding，需要中间翻译、事先约定传输协议</li></ul></li></ol><hr><h3 id="CH2-分布式计算环境"><a href="#CH2-分布式计算环境" class="headerlink" title="CH2 - 分布式计算环境"></a>CH2 - 分布式计算环境</h3><h4 id="DCE"><a href="#DCE" class="headerlink" title="DCE"></a>DCE</h4><blockquote><p>The <code>Distributed Computing Environment (DCE)</code> is a software system developed in the early 1990s by a consortium that included Apollo Computer (later part of Hewlett-Packard), IBM, Digital Equipment Corporation, and others. The DCE supplies a framework and toolkit for developing client/server applications. The framework includes a <em>remote procedure call (RPC)</em> mechanism known as DCE/RPC, a <em>naming (directory) service</em>, a <em>time service</em>, an <em>authentication service</em> and a <em>distributed file system (DFS)</em> known as DCE/DFS. DCE was a big step in direction to standardisation of architectures, which were manufacturer dependent before. Similar to the OSI model, DCE has not seen much success in practical implementation; however, its underlying concepts have had more substantial influence over subsequent efforts. BY <a href="https://en.wikipedia.org/wiki/Distributed_Computing_Environment" title="Wikipedia" target="_blank" rel="noopener"><strong>Wikipedia</strong></a></p></blockquote><p>DCE的<em>两类服务</em>：</p><ol start="0"><li>线程服务：客户和服务器内部可以有多个控制流，从而实现内部的<em>并行处理</em></li><li>RPC服务：提供DCE环境中所需的进程之间的通信工具，对客户访问远程服务器提供了支持，提供了统一的数据类型，屏蔽了字节顺序、相关语言的细节，从而实现了开放分布式处理中的<em>访问透明性</em>和<em>位置透明性</em>。</li><li>目录服务：允许客户在整个分布式环境中寻找自己的服务，即完成两部分任务=&gt;服务器进行服务注册；客户进行服务查找。具体来说，包括两个独立的组成部分：CDS（Cell Diretory Service）和GDS（Global Directory Service）<br>CDS在一个逻辑组内提供一个层次型的命名空间，GDS实现一个全系统的目录服务。</li><li>安全服务：保证DCE中服务器访问的<em>安全性</em>。主要包括身份认证、权限检查、数据加密等。</li><li>分布式文件服务：提供对本地系统和远程系统中文件的<em>访问透明性</em>。</li><li>时间服务：提供了一个时间同步标尺，用于确保整个系统中各个部分的<em>时间一致性</em>。</li></ol><p>DCE有<em>三个文件</em>：界面定义文件，客户程序，服务器程序</p><h3 id="CH3-ODP和CORBA介绍"><a href="#CH3-ODP和CORBA介绍" class="headerlink" title="CH3 - ODP和CORBA介绍"></a>CH3 - ODP和CORBA介绍</h3><h4 id="ODP"><a href="#ODP" class="headerlink" title="ODP"></a>ODP</h4><blockquote><p><code>Reference Model of Open Distributed Processing (RM-ODP)</code> is a reference model in computer science, which provides a co-ordinating framework for the standardization of open distributed processing (ODP). It supports distribution, interworking, platform and technology independence, and portability, together with an enterprise architecture framework for the specification of ODP systems. BY <a href="https://en.wikipedia.org/wiki/RM-ODP" title="Wikipedia" target="_blank" rel="noopener"><strong>Wikipedia</strong></a></p></blockquote><p><strong>开放分布式处理参考模型(RM-ODP, Reference Model of Open Distributed Processing)</strong>是一种标准，规定了使用于开放式分布处理领域内的其他标准必须遵循的参考模型。</p><p><code>RM-ODP Viewport</code>从不同侧面描述了分布式系统，有如下5个viewpoint：</p><ul><li>enterprise viewpoint</li><li>information viewpoint</li><li>computational viewpoint</li><li>engineering viewpoint</li><li><p>technology viewpoint</p><p><img src="https://upload.wikimedia.org/wikipedia/commons/7/7b/RM-ODP_viewpoints.jpg" alt="RM-ODP Viewpoints" title="RM-ODP Viewpoints"><br>“By Marcel Douwe Dekker (Own work) [CC BY-SA 3.0][] or [GFDL][], via Wikimedia Commons”</p></li></ul><p>RM-ODP的<em>透明性</em>屏蔽了由系统的分布所带来的复杂性。</p><blockquote><p>While ODP transparencies provide insight into what a distributed system look like, <em>ODP functions</em> provide some building blocks to assemble ODP systems.</p></blockquote><p>ODP功能可以划分为4组: 管理功能组，协作功能组，仓库功能组，安全功能组<br>ODP与其他规范的关系：ODP独立于任何具体的网络协议；它不仅是一个一般标准，还是一个<em>标准的标准</em>，即规定了使用开放分布式处理领域内的其他标准应当遵循的标准。</p><hr><h4 id="CORBA"><a href="#CORBA" class="headerlink" title="CORBA"></a>CORBA</h4><blockquote><p>The <code>Common Object Request Broker Architecture (CORBA)</code> is a standard defined by the Object Management Group (OMG) designed to facilitate the communication of systems that are deployed on diverse platforms. CORBA enables collaboration between systems on different operating systems, programming languages, and computing hardware. CORBA uses an object-oriented model although the systems that use CORBA do not have to be object-oriented. CORBA is an example of the distributed object paradigm. BY <a href="https://en.wikipedia.org/wiki/Common_Object_Request_Broker_Architecture" title="Wikipedia" target="_blank" rel="noopener"><strong>Wikipedia</strong></a></p></blockquote><p><strong>公共对象请求代理体系结构(CORBA，Common Object Request Broker Architecture)</strong>是由OMG提出的<em>应用软件体系结构</em>和<em>对象技术规范</em>。其核心是一套标准的语言、接口和协议，以支持<em>异构分布应用程序间的互操作性</em>及<em>独立于平台和编程语言的对象重用</em>，它使用了<em>面向对象模型</em>实现分布式系统中的透明服务请求。</p><p>对象管理体系结构，OMA描述了面向对象技术在分布式处理中的运用，它包括两部分：</p><ul><li>对象模型(Object Model)：定义如何描述分布式异质环境中的对象。对象是一个被封装的实体，具有一个不可改变的标志；对象的访问方式是通过向对象发出请求来完成。</li><li>参考模型(Reference Model)：描述对象之间的交互。该模型中定义了一条为对象所共用的通信总线，即ORB(Object Request Broker)。通过ORB，一个Client可以透明地调用一台机器上或网络上的一个Server对象的方法。并定义了对象进出这一总线的界面，包括：<ul><li>对象服务(Object Services)：提供基础服务，与具体领域无关的界面。主要包括命名服务、持久化服务、生存周期服务、事务处理服务、事件服务、安全服务。</li><li>公共设施(Common Facilities)：面向最终用户的应用，是各种应用可以共享的一系列服务集合。</li><li>应用界面(Application Interface)：针对某一个具体应用而产生。</li><li>域界面(Domain Interface)：针对某一特殊的应用领域。</li></ul></li></ul><p><img src="http://7xuthx.com1.z0.glb.clouddn.com/review-middleware%2Fimage%2FOMA%E5%8F%82%E8%80%83%E6%A8%A1%E5%9E%8B.png" alt="OMA 参考模型" title="OMA 参考模型"></p><p>CORBA规范主要包含如下内容：</p><ul><li>ORB核心</li><li>OMG界面定义语言</li><li>界面仓库和实现仓库</li><li>语言映射</li><li>存根和框架</li><li>动态调用</li><li>对象适配器</li><li>ORB之间的互操作</li></ul><p><img src="http://7xuthx.com1.z0.glb.clouddn.com/review-middleware%2Fimage%2FCORBA%E4%B8%BB%E8%A6%81%E5%86%85%E5%AE%B9.png" alt="CORBA主要内容" title="CORBA主要内容"></p><h3 id="CH4-远程过程调用RPC"><a href="#CH4-远程过程调用RPC" class="headerlink" title="CH4 - 远程过程调用RPC"></a>CH4 - 远程过程调用RPC</h3><h4 id="RPC"><a href="#RPC" class="headerlink" title="RPC"></a>RPC</h4><blockquote><p>In distributed computing, a <code>remote procedure call (RPC)</code> is when a computer program causes a procedure (subroutine) to execute in another address space (commonly on another computer on a shared network), which is coded as if it were a normal (local) procedure call, without the programmer explicitly coding the details for the remote interaction. BY <a href="https://en.wikipedia.org/wiki/Remote_procedure_call" title="Wikipedia" target="_blank" rel="noopener"><strong>Wikipedia</strong></a></p></blockquote><p>远程过程调用协议(Remote Procedure Call, RPC)是一种通过网络从远程计算机程序上请求服务，而不需要了解底层网络技术的协议。<br>RPC是一个C/S架构，调用程序片称为<code>RPC Client</code>，被调用程序片称为<code>RPC Server</code>。</p><p><img src="http://7xuthx.com1.z0.glb.clouddn.com/image%2Freview-middleware%2FRMI%E5%AE%9E%E7%8E%B0%E6%A8%A1%E5%9E%8B.png" alt="RMI实现模型" title="RMI实现模型"><br><img src="http://7xuthx.com1.z0.glb.clouddn.com/image%2Freview-middleware%2FRMI%E6%89%A7%E8%A1%8C%E6%A8%A1%E5%9E%8B.png" alt="RMI执行模型" title="RMI执行模型"><br><img src="http://7xuthx.com1.z0.glb.clouddn.com/image/review-middleware/RMI%E9%80%9A%E4%BF%A1%E6%A8%A1%E5%9E%8B.png" alt="RMI 通信模型" title="RMI通信模型"></p><p>RPC编程流程：</p><ol><li>构建解决问题的常规应用程序</li><li>选择一组过程形成远程程序</li><li>为远程程序编写RPC界面</li><li>运行RPCGEN检查该界面，并生成四个代码文件，供Client/Server使用</li><li>为Client/Server编写stub接口例程</li><li>编译并链接客户程序</li><li>编译并链接服务器程序</li><li>在远程机器上启动服务器，接着在本机上运行客户程序</li></ol><p>RPC的优势：支持<em>位置透明性</em>，被调用的函数不论是在本地还是在远程都可以使用RPC实现；之外，RPC的出现可以让程序开发人员集中精力在程序功能的实现上；位置透明性此外还可以让三层系统拓展到多层；RPC还内置了对<em>安全性</em>的支持</p><hr><h4 id="RPC的Java实现"><a href="#RPC的Java实现" class="headerlink" title="RPC的Java实现"></a>RPC的Java实现</h4><p>Java RMI(Java Remote Method Invocation)是Java编程语言里面一种用于实现<em>远程过程调用</em>的应用程序编程接口，目前使用<code>JRMP(Java Remote Messaging Protocol)</code>进行通信。它是纯Java的网络分布式应用系统的核心解决方案之一。<br>RMI与CORBA的关系：因为两者都提供了对远程分布式对象的透明方格网，常被视为相互竞争的技术；但两种技术实际上是互相补充的，一者的长处正好弥补另一者的短处。<br>RMI的优点：支持面向对象；可移动属性；安全；便于编写和使用；可连接现有/原有的系统；编写一次、到处运行；分布式垃圾收集；并行计算</p><hr><h3 id="CH5-组件技术概述"><a href="#CH5-组件技术概述" class="headerlink" title="CH5 - 组件技术概述"></a>CH5 - 组件技术概述</h3><h4 id="组件的概念"><a href="#组件的概念" class="headerlink" title="组件的概念"></a>组件的概念</h4><p><em>组件</em>是一个不透明的功能实体，能够被第三方组装，且符合一个构件模型。(CMU)<br><em>组件</em>是系统中一种物理的、可替代的部件、它封装了实现并提供了一系列可用的接口。一个组件代表了一个系统中实现的物理部分，包括软件代码或者一些类似内容，如源代码、命名文件等。(OMG)<br>组件技术是一种优秀的<em>软件重用技术</em>；组件技术的思想是将一个复杂的大型系统中的基础服务分解为若干个独立的单元；利用组件之间建立的统一的严格的连接标准，实现组件间和组件与用户之间的服务连接。<br>连接是建立在<em>目标代码级</em>上的，与平台无关。<br>组件技术的好处：</p><ul><li>组件可替换，以便随时进行系统升级和定制</li><li>可以在多个应用系统中重复利用同一个组件</li><li>可以方便的将应用系统扩展到网络环境下</li><li>部分组件与平台和语言无关，所有的程序员均可参与编写</li></ul><hr><h4 id="COM组件的定义和特点"><a href="#COM组件的定义和特点" class="headerlink" title="COM组件的定义和特点"></a>COM组件的定义和特点</h4><blockquote><p>COM, Component Object Model是软件组件互相通信的一种方式， 它是一种二进制和网络标准， 允许任意两个组件互相通信， 而不管它们在什么计算机上运行（ 只要计算机是相连的）， 不管计算机运行的什么操作系统（只要该操作系统支持COM） ， 也不管该组件机是用什么语言编写的。</p></blockquote><p>COM的特点：</p><ol><li>基于C/S模型：每个COM对象的工作方式都类似于服务器，可以接收和处理来自客户程序的请求，并自动回复信息</li><li>建立在二进制层次上的标准：与编程语言和开发工具无关</li></ol><p>COM的基本概念：</p><ul><li>COM规范：平台无关；定义了大量的接口</li><li>COM实现：平台相关；Windows实现了规范及其许多功能</li><li>COM接口：客户与对象之间的协议，客户使用COM接口调用COM对象的服务</li><li>COM对象：实现COM接口；通过COM接口提供服务；可包含多个接口</li><li>COM组件：COM对象的载体，可包含多个COM对象；可独立发布的二进制组件；在Windows平台下为dll或exe文件</li></ul><p>COM接口：</p><ol><li>接口标识，即IID，是GUID的一种用法，具有全球唯一性</li><li>IUnknown：所有的COM接口都从IUnknown派生。接口IUnknown意为不用知道潜在的对象是什么，因为每个COM对象都实现了该接口。</li><li>COM接口二进制结构</li></ol><p>COM对象：</p><ol><li>客户的交互实体</li><li>包括属性和方法，或者状态和操作</li><li>能够提供服务</li></ol><p>COM对象与C++对象的比较：</p><ul><li>C++对象 = 多态性 + (部分)迟绑定 + (部分)封装 + (实现/接口)继承</li><li>COM对象 = 多态性 + (完全)迟绑定 + (完全)封装 + 接口继承 + 二进制重用性</li></ul><hr><h3 id="CH6-Web服务器技术"><a href="#CH6-Web服务器技术" class="headerlink" title="CH6 - Web服务器技术"></a>CH6 - Web服务器技术</h3><h4 id="Web服务器"><a href="#Web服务器" class="headerlink" title="Web服务器"></a>Web服务器</h4><p>Web服务器的工作流程可分为4个步骤：连接过程、请求过程、应答过程及关闭过程。其中，连接过程、请求过程、关闭过程都是较为标准的例行程序，关键业务多在于应答过程中。<br>Web服务器就是分离抽象出服务器的基本执行流程，例行的标准化的流程由服务器来处理，而用户更多的负责定义个性化的、非标准的流程。</p><p>MVC架构：<br>Model/View/Controller很好的抽象了客户端和服务端的访问流程范围图。<code>Model</code>是应用程序中用于处理应用程序数据逻辑的部分，通常模型对象负责在数据库中存取数据；<code>View</code>是应用程序中处理数据显示的部分，通常视图是依据模型数据所建立的；<code>Controller</code>是应用程序中处理用户交互的部分，常负责从视图中读取数据、控制用户输入、先模型发送数据。</p><hr><h4 id="JavaEE"><a href="#JavaEE" class="headerlink" title="JavaEE"></a>JavaEE</h4><p>Java EE(Java Platform, Enterprise Edition)是SUN公司推出的企业版应用程序版本，能够开发部署<em>可移植</em>、<em>健壮</em>、<em>可伸缩</em>且<em>安全</em>的Web应用和企业应用，具备快速响应性和适应用户需求增长的伸缩性。<br><img src="http://7xuthx.com1.z0.glb.clouddn.com/image/review-middleware/JavaEE7%E7%9A%84%E6%9E%B6%E6%9E%84.png" alt="Java EE 7的架构" title="Java EE 7的架构"></p><p>Java EE平台由一整套服务、应用程序接口和协议构成，它对开发基于Web的多层应用提供了功能支持。</p><ul><li><code>JDBC (Java Database Connectivity)</code>提供连接各种关系数据库的统一接口，可以为多种关系数据库提供统一访问。</li><li><code>EJB (Enterprise JavaBeans)</code>提供一个开发和实施分布式商务逻辑的规范，使得开发者方便地创建、部署和管理跨平台的基于组件的、具有可伸缩性和高度复杂的企业应用。</li><li><code>Java RMI (Java Remote Method Invocation)</code>用来开发分布式Java应用程序，让一个Java对象可以被远程的Java调用。</li><li><code>JMS (Java Message Service)</code>提供企业消息服务。</li><li><code>JTS (Java Transaction Service)</code>提供存取事务处理资源的开放标准，这些事务处理资源包括事务处理应用程序、事务处理管理及监控。</li><li><code>Annotation (Java Annotation)</code>提供一种机制，将程序的元素如:类，方法，属性，参数，本地变量，包和元数据联系起来。</li><li><code>JMF (Java Media Framework API)</code>为多媒体开发者提供了捕捉、回放、编解码等工具，是一个弹性的、跨平台的多媒体解决方案。</li><li><code>JMX (Java Management Extensions)</code>是一个为应用程序、设备、系统等植入管理功能的框架。</li><li><code>JPA (Java Persistence API)</code>提供了对象持久化到关系数据库的解决方案规范。</li></ul><hr><h4 id="EJB与Spring"><a href="#EJB与Spring" class="headerlink" title="EJB与Spring"></a>EJB与Spring</h4><p>EJB是sun公司的JavaEE服务器端组件模型，设计目标与核心应用是<em>部署分布式应用程序</em>。EJB运行在一个容器里，允许开发者只关注与bean中的业务逻辑而不用考虑象事务支持，安全性和远程对象访问等复杂和容易出错的事情。EJB以POJO对象形式开发，开发者可以用元数据注释来定义容器如何管理这些Bean。<br>EJB3中包含有两种类型：</p><ul><li><code>Session Bean</code>：被客户端调用用于处理某一具体的操作业务的Java对象实体。又可以根据是否维护状态，划分为无状态会话Bean和状态会话Bean。</li><li><code>Message Driven Bean, MDB</code>：提供了一个实现异步通信的方法，比直接使用JMS更加容易。对于客户机来说，MDB是一个在服务器上实现某些业务逻辑的JMS消息使用者。</li></ul><p><img src="http://7xuthx.com1.z0.glb.clouddn.com/image/review-middleware/EJB%E7%BC%96%E7%A8%8B%E6%A1%86%E6%9E%B6.png" alt="EJB编程框架" title="EJB编程框架 - 图片引自 Mastering EJB 3.0"></p><p>Spring框架</p><ul><li>控制反转(IoC)</li><li>面向切面(Aspect Oriented Programming, AOP)</li><li>依赖注入(Dependency Injection, DI)</li></ul><p>Spring和EJB框架结构都有一个共同核心的设计理念：<strong>将中间件服务传递给耦合松散的POJO对象(Plain Old Java Objects)</strong></p><p>与Web容器相关的技术</p><ul><li>反射(Reflection)是指程序可以访问、检测和修改它本身状态和行为的一种能力。</li><li>注解(Annotation)也称为元数据，一种代码级别的说明。与类、接口、枚举位于同义层次，可以用于包、类、字段、方法、局部变量、方法参数等，对元素进行说明注释。</li><li>依赖注入(Dependency Injection)指容器负责对象的创建、对象间的关联，并管理对象的生命周期。</li><li><p>面向切面编程(Aspect Oriented Programming)通过预编译方式和运行期动态代理的方式，实现程序功能的统一和维护的技术。<br>AOP将应用程序划分为<em>核心业务逻辑</em>和<em>横向的通用逻辑</em>。AOP主要致力于横向的通用逻辑问题的解决，如持久化管理、事务管理、日志管理等。<br>在AOP中有如下几个概念：</p><ol><li>连接点 (Joinpoint)指程序执行过程中某一个方面可以插入的点。</li><li>通知 (Advice)指在特定的连接点AOP框架执行的动作。</li><li>切入点 (Pointcut)用来指定通知(Advice)将被执行的一系列连接点的集合。</li><li>方面 (Aspect)是一个关注点的模块化，由通知(Advice)和切入点(Pointcut)组成。</li><li>目标对象 (Target Object)是包含连接点的对象，也被称作被通知或被代理对象。</li><li>引入 (Introduction)允许添加新的方法或字段到被通知的类。</li><li>AOP代理 (AOP Proxy)是AOP框架创建的对象，包含通知。</li><li><p>编织 (Weaving)把方面应用到目标对象，从而创建一个新的代理对象的过程。</p><p><img src="http://7xuthx.com1.z0.glb.clouddn.com/image/review-middleware/AOP%E7%9A%84%E7%BB%84%E6%88%90%E9%83%A8%E5%88%86.png" alt="AOP组成部分" title="AOP组成部分"></p></li></ol></li></ul><hr><h3 id="CH7-消息中间件"><a href="#CH7-消息中间件" class="headerlink" title="CH7- 消息中间件"></a>CH7- 消息中间件</h3><h4 id="消息中间件的概念"><a href="#消息中间件的概念" class="headerlink" title="消息中间件的概念"></a>消息中间件的概念</h4><p>分布式对象调用的局限性：客户发出调用后，一般需要等待服务对象完成并返回结果后才能继续执行；客户和服务对象的生命周期紧密耦合。<br><strong>消息中间件(Message Oriented Middleware)</strong>是在分布式系统中完成消息的发送和接收的基础软件。消息中间件支持与保障分布式应用程序之间的<em>同步或异步</em>地收发消息。<br>在消息中间件中， 发送方在发送消息时不必知道接收方的状态，更无须等待接收方的回复；接收方在收到消息时不必知道发送方的目前状态，也无须进行同步的消息处理。即消息的收发双方完全是<em>松耦合</em>的，通信是非阻塞的；收发双方彼此之间不知道对方的存在，不受对方的影响。这些都提高了程序的<em>性能</em>、<em>可扩展性</em>及<em>健壮性</em>。</p><p>消息中间件分为点对点与消息代理（订阅者与发布者）两种模式。<br>传统的<em>点对点</em>消息中间件通常由消息队列服务、消息传递服务、消息队列和消息应用程序接口API组成。<br><img src="http://7xuthx.com1.z0.glb.clouddn.com/image/review-middleware/%E7%82%B9%E5%AF%B9%E7%82%B9-%E6%B6%88%E6%81%AF%E4%B8%AD%E9%97%B4%E4%BB%B6%E6%9E%B6%E6%9E%84.png" alt="点对点-消息中间件架构" title="点对点-消息中间件架构"></p><p>在基于消息代理的分布式应用系统中，消息的发送方称为出版者(Publisher)，消息的接收方称为订阅者(Subscriber)，不同的消息通过不同的主题进行区分。消息代理实现了发布者和订阅者的解耦：</p><ul><li>时间解耦，发布者和订阅者无需同时在线就能够进行消息传输，消息中间件通过存储转发提供了异步传输的能力</li><li>空间解耦，发布者和订阅者都无需知道对方的物理地址、端口等。</li><li>流程解耦，发布者和订阅者在发送和接收数据时并不阻塞各自的控制流程。<br><img src="http://7xuthx.com1.z0.glb.clouddn.com/image/review-middleware/%E8%AE%A2%E9%98%85%E5%8F%91%E5%B8%83-%E6%B6%88%E6%81%AF%E4%B8%AD%E9%97%B4%E4%BB%B6%E6%9E%B6%E6%9E%84.png" alt="订阅发布-消息中间件架构" title="消息代理-消息中间件架构"></li></ul><hr><h4 id="Java-Message-Service"><a href="#Java-Message-Service" class="headerlink" title="Java Message Service"></a>Java Message Service</h4><p>JMS，即Java Message Service是Java平台上有关面向消息中间件(MOM)的技术规范，它便于消息系统中的Java应用程序进行消息交换，并且通过提供标准的产生、发送、接收消息的接口简化企业应用的开发。<br>JMS支持两种消息传递模型：</p><ul><li>点对点，Point-to-Point，简称为PTP</li><li>发布/订阅，Publish/Subscribe，简称为Pub/Sub<br>JMS提供两种消息投递的方式：</li><li>NON_PERSISTENT，最多投递一次</li><li>PERSISTENT，消息将暂存后再转送投递</li></ul><p>消息驱动Bean (MDB)<br>MDB, Message Driven Bean是用来转换处理基于消息请求的组件。它主要负责处理消息，让开发人员集中精力在消息处理的业务逻辑上。</p><hr><h3 id="CH8-数据存取中间件"><a href="#CH8-数据存取中间件" class="headerlink" title="CH8 - 数据存取中间件"></a>CH8 - 数据存取中间件</h3><h4 id="开放数据库连接"><a href="#开放数据库连接" class="headerlink" title="开放数据库连接"></a>开放数据库连接</h4><p>ODBC即Open Database Connectivity，是一种用来在关系或非关系型数据库管理系统（DBMS）中存取数据的标准应用程序数据接口。<br>ODBC的四个主要部分：</p><ul><li>应用程序接口，屏蔽不同的ODBC数据库驱动器之间函数调用的差别，为用户提供统一的SQL编程接口。</li><li>驱动器管理器，为应用程序装载数据库驱动器。</li><li>数据库驱动器，实现ODBC的函数调用，提供对特定数据源的SQL请求。如果需要，数据库驱动器将修改应用程序的请求，使得请求符合相关的DBMS所支持的文法。</li><li>数据源，由用户想要存取的数据以及与它相关的操作系统、DBMS和用于访问DBMS的网络平台组成。</li></ul><p><img src="http://7xuthx.com1.z0.glb.clouddn.com/image/review-middleware/ODBC%E4%BD%93%E7%B3%BB%E6%9E%B6%E6%9E%84.PNG" alt="ODBC体系架构" title="ODBC体系架构"></p><p>为了应对非结构化数据，微软提出了OLE DB技术(Object Link and Embed)，即对象连接与嵌入技术。OLE DB是一个非常好的构架，允许程序员存取各类数据，但太过底层，使用复杂。<br><img src="http://7xuthx.com1.z0.glb.clouddn.com/image/review-middleware/OLEDB%E4%BD%93%E7%B3%BB%E6%9E%B6%E6%9E%84.PNG" alt="OLE DB体系结构" title="OLE DB体系结构"></p><p>为了解决上述问题，微软使用COM技术封装了OLE DB为<em>ADO对象</em>，简化了通过OLE DB数据存取的复杂性。<br><img src="http://7xuthx.com1.z0.glb.clouddn.com/image/review-middleware/ODBC_OLEDB_ADO%E5%85%B3%E7%B3%BB%E5%9B%BE.PNG" alt="ODBC、OLE DB、ADO关系" title="ODBC、OLE DB、ADO关系"></p><hr><h4 id="JDBC"><a href="#JDBC" class="headerlink" title="JDBC"></a>JDBC</h4><p>JDBC,Java Database Connectivity是Java与数据库的接口规范。JDBC定义了一个支持标准SQL功能的通用低层的API，旨在让各数据库开发商为Java程序员提供标准的数据库API。</p><p>JDBC与ODBC的异同点：ODBC以C/C++的API形式提供服务，而JDBC以Java的API形式提供服务；JDBC的设计在思想上沿袭了ODBC，同时在其主要抽象和SQL调用级接口实现上也沿袭了ODBC；相较于ODBC，JDBC配置更容易，也更具有面向对象的思想。</p><hr><h4 id="对象关系映射ORM"><a href="#对象关系映射ORM" class="headerlink" title="对象关系映射ORM"></a>对象关系映射ORM</h4><p>ORM，Object Relational Mapping，是通过使用描述对象和数据库之间的映射的元数据，将程序中的对象自动持久化到关系型数据库中的一项技术。</p><p>Hibernate是一个开放源代码的对象关系映射框架，它对JDBC进行了非常轻量级的对象封装，使得Java程序员可以随心所欲的使用对象编程思维来操纵数据库。<br><img src="http://7xuthx.com1.z0.glb.clouddn.com/image/review-middleware/Hibernate%E6%89%80%E6%89%AE%E6%BC%94%E7%9A%84%E8%A7%92%E8%89%B2.PNG" alt="Hibernate所扮演的角色" title="Hibernate所扮演的角色"></p><hr><h4 id="JPA介绍"><a href="#JPA介绍" class="headerlink" title="JPA介绍"></a>JPA介绍</h4><p>Java Persistence API，用于对象持久化的API，是Java EE 5.0 平台标准的ORM规范，使得应用程序以统一的方式访问持久层。提供了将POJO转化为持久化对象的机制规范。</p><p>JPA与Hibernate的关系：</p><ul><li>JPA是规范，而Hibernate是具体实现</li><li>从功能上来说，JPA是Hibernate功能的一个子集</li></ul><p>JPA的优势：标准化；对容器级特性的支持；简单易用、集成方便；可媲美JDBC的查询能力；支持面向对象的高级特性；</p><p>JPQL介绍<br>JPQL，Java Persistence Query Language，即Java持久化查询语言是一种可移植的查询语言，可以被编译成所有主流数据库的SQL。JPQL是面向对象的，通过面向对象而非面向数据库的查询语言查询数据，避免程序的SQL语句紧密耦合。</p><hr><h3 id="CH9-事务处理中间件"><a href="#CH9-事务处理中间件" class="headerlink" title="CH9 - 事务处理中间件"></a>CH9 - 事务处理中间件</h3><h4 id="事务"><a href="#事务" class="headerlink" title="事务"></a>事务</h4><p>事务是计算机应用中不可或缺的组件模型，它保证了用户操作的<strong>ACID</strong>，即<code>原子性(Atomicity)</code>、<code>一致性(Consistency)</code>、<code>隔离性(Isolation)</code>和<code>持久性(Durabilily)</code>。<br>JDBC的事务是基于Connection进行的，默认情况是<em>自动提交事务</em>，也可以手动提交或者回滚。<br>分布式事务是指事务的参与者、支持事务的服务器、资源服务器以及事务管理器分别位于不同的分布式系统的不同节点之上。分布式事务处理系统旨在协助在分布式环境中跨异类的事务识别资源的事务。<br>在分布式系统中，事务往往包含有多个参与者的活动，单个参与者上的活动是能够保证原子性的，而多个参与者之间原子性的保证则需要通过两阶段提交来实现，<strong>两阶段提交</strong>是分布式事务实现的关键。<br><img src="http://7xuthx.com1.z0.glb.clouddn.com/image%2Freview-middleware%2F%E4%B8%A4%E9%98%B6%E6%AE%B5%E6%8F%90%E4%BA%A4%E5%8D%8F%E8%AE%AE.PNG" alt="两阶段提交协议" title="两阶段提交协议"></p><p>在分布式事务两阶段提交协议中，有一个主事务管理器负责充当<strong>分布式事务协调器</strong>的角色。事务协调器负责整个事务，并使之与网络中的其他事务管理器(参与者)协同工作。具体来说两阶段提交协议，按照如下两步进行：</p><ol><li>协调者在自身的节点的日志中写入一条<em>日志记录</em>，然后向所有参与者发送消息<code>prepare T</code>，询问这些参与者（包括自身），是否能够提交这个事务；参与者在接受到这个<code>prepare T</code>消息以后，会根据自身的情况，进行事务的预处理：<ul><li>如果参与者能够提交该事务，则会将日志写入磁盘，并返回给协调者一个<code>ready T</code>信息，同时自身进入预提交状态状态；</li><li>如果不能提交该事务，则记录日志，并返回一个<code>not commit T</code>信息给协调者，同时撤销在自身上所做的数据库改；参与者能够推迟发送响应的时间，但最终还是需要发送的。</li></ul></li><li>协调者会收集所有参与者的意见，如果收到参与者发来的<code>not commit T</code>信息，则标识着该事务不能提交，协调者会将<code>Abort T</code>记录到日志中，并向所有参与者发送一个<code>Abort T</code>信息，让所有参与者撤销在自身上所有的预操作；如果协调者收到所有参与者发来<code>prepare T</code>信息，那么协调者会将<code>Commit T</code>日志写入磁盘，并向所有参与者发送一个<code>Commit T</code>信息，提交该事务；如果协调者迟迟未收到某个参与者发来的信息，则认为该参与者发送了一个<code>VOTE_ABORT</code>信息，从而取消该事务的执行。<br>参与者接收到协调者发来的<code>Abort T</code>信息以后，参与者会终止提交，并将<code>Abort T</code>记录到日志中；如果参与者收到的是<code>Commit T</code>信息，则会将事务进行提交，并写入记录。</li></ol><p>注意上述操作中，各个参与者在进行每一步操作时都要<em>事先写入日志</em>。<br>一般情况下，两阶段提交协议都能较好的运行，当在事务进行过程中，有参与者宕机时，它重启之后，可以通过询问其他参与者或者协调者，从而知道这个事务到底有没有提交了；而如果协调者在第二阶段前宕机，就会导致部分参与者收不到<code>Abort T</code>或者<code>Commit T</code>的命令，此时就需要数据库管理员介入，防止数据库的不一致状态。<br>另外，为了实现分布式事务必须使用一种协议在分布式事务的各个参与者之间传递事务上下文信息，<code>互联网内部对象请求代理协议(IIOP, Internet Inter-ORB Protocol)</code>便是这种协议。</p><p>再来看看分布式事务的<code>ACID</code>特性，两阶段提交协议保证了事务的<code>原子性(Atomicity)</code>；数据库的完整性约束保证了事务的<code>一致性(Consistency)</code>；数据库位置的不同及数据库自身的对事务隔离的支持保证了事务的<code>隔离性(Isolation)</code>；数据库的日志保证了事务的<code>持久性(Durability)</code>。</p><hr><h4 id="EJB事务体系结构"><a href="#EJB事务体系结构" class="headerlink" title="EJB事务体系结构"></a>EJB事务体系结构</h4><p><code>JTA, Java Transaction API</code>和<code>JTS, Java Transaction Service</code>为Java EE平台提供了分布式事务服务。<code>JTS</code>定义了一套规范，它约定了各个程序角色之间如何传递事务上下文，它源自CORBA的OTS规范，基于IIOP。<code>JTA</code>约定这些角色要进行哪些事务上下文的交互，<code>JTS</code>约定了应该怎样去进行交互。<br>EJB有两种使用事务的方式：通过容器管理的事务，叫CMT；通过Bean管理的事务，叫BMT。<br><code>JTA</code>是一种高层的、与实现无关的、与协议无关的API，应用程序和应用服务器可以使用JTA实现事务管理。与JDBC主要用于管理单个数据源的事务不同，JTA主要管理分布式情况下的事务操作。在JTA中，一个分布式事务包括一个<em>事务管理器(Transaction Manager)</em>和一个或多个<em>资源管理器(Resource Manager)</em>。资源管理器是任意类型的支持XA协议的持久化数据存储，事务管理器承担着所有事务参与单元的协调与控制。</p><p>JTA的事务管理器和资源管理器可以理解为两个方面：面向开发人员的使用接口（事务管理器）和面向服务器提供商的实现接口（资源管理器）。</p><hr><h3 id="CH10-Web服务"><a href="#CH10-Web服务" class="headerlink" title="CH10 - Web服务"></a>CH10 - Web服务</h3><h4 id="Web-Service的概念"><a href="#Web-Service的概念" class="headerlink" title="Web Service的概念"></a>Web Service的概念</h4><blockquote><p>A <code>Web Service</code> is a software system designed to support interoperable machine-to-machine interaction over a network. It has an interface described in a machine-processable format (specifically <code>WSDL</code>). Other systems interact with the Web Service in a manner prescribed by its description using <code>SOAP</code> messages, typically conveyed using HTTP with an XML serialization in conjunction with other Web-related standards.</p></blockquote><p>常见的两种Web Service处理方式包含：</p><ul><li>基于WSDL/SOAP的方式</li><li>基于RESTful风格的方式</li></ul><p>Web Service的工作原理分为两步：首先是在服务器上创造服务并将其在一台“目录服务器”上注册；然后客户端查找并调用该服务。</p><ol><li>服务器按规格生成服务的类和方法如Java Bean，使其能够接受和响应SOAP消息</li><li>撰写WSDL文件用于描述此Web Services，服务器向“目录服务器”注册自己的这些方法。</li><li>将此WSDL发布到目录服务器上，对外发布一个可调用的服务目录</li><li>客户端向“目录服务器”查找这些服务，获得这些服务的地址之后再去请求服务</li></ol><p><img src="http://7xuthx.com1.z0.glb.clouddn.com/image%2Freview-middleware%2FWeb%20Service%E7%9A%84%E4%BD%93%E7%B3%BB%E7%BB%93%E6%9E%84.PNG" alt="Web Service的体系架构" title="Web Service的体系架构"></p><p><code>WSDL, Web Service Description Language</code>是Web Service的描述语言，它包含一系列描述某个Web Service的定义。包括服务端ᨀ供的服务，调用方法，以及调用时所要遵循的格式，比如调用参数和返回值的格式等等。<br><code>SOAP, Simple Object Access Protocol</code>提供了标准的远程过程调用(RPC)方法来调用Web Service。SOAP规范定义了SOAP消息的格式，以及怎样通过HTTP协议来使用SOAP。客户端和服务端之间的方法调用请求和结果返回值都放在这些消息里。<br><code>UUDI, Universal Description, Discovery and Integration</code>提供了一种发布和查找服务描述的方法。 UDDI数据实体提供对定义业务和服务信息的支持。</p><p><img src="http://7xuthx.com1.z0.glb.clouddn.com/image%2Freview-middleware%2FUDDI%E3%80%81WSDL%E5%92%8CSOAP%E7%9A%84%E5%85%B3%E7%B3%BB.PNG" alt="UDDI、WSDL和SOAP的关系" title="UDDI、WSDL和SOAP的关系"></p><p>Web Service的主要目标是跨平台的可互操作性。为了达到这个目标，Web Service完全基于XML、XSD等独立于平台、独立于软件供应商的标准，是创建可互操作的、分布式应用程序的新平台。<br>Web Service的主要优势：</p><ol><li>异构平台的互通性</li><li>更广泛的软件复用</li><li>普通的通信要求：使用基于XML的SOAP表示数据和调用请求，通过HTTP传送这些文本信息。</li><li>迅捷的软件发行方式</li><li>方便的商务集成：企业可以把业务核心以Web Service的形式向其伙伴发布。</li></ol><p><code>JAXB, Java Architecture for XML Binding</code>是一个业界标准，是一项可以根据XML Schema产生Java类的方式，也允许将Java类映射为XML表现方式。<br>JAX-WS是Web Service的Java实现。</p><hr><h4 id="REST"><a href="#REST" class="headerlink" title="REST"></a>REST</h4><p><code>RESTful(REpresentation State Transfer)</code>描述了一个架构样式的网络系统，它指代一组架构约束条件和原则，满足这些约束条件和原则的应用程序或设计就是RESTful。<br>具体来说， REST是一种轻量级的Web Service架构风格，其实现和操作明显比SOAP和XML-RPC更为简洁，可以完全通过HTTP协议实现，还可以利用缓存Cache来提高响应速度，性能、效率和易用性上都很有优势。<br>REST的资源用URI描述，REST的操作遵从CRUD(Create, Read, Update, Delete)原则。<br>与Web Service一样，REST也包含了无状态性。但是这并不意味着REST不支持状态，REST可以通过将状态信息保存在客户端上，或者保存在资源中。服务器端不保持除了单次请求之外的任何与其通信的客户端的通信状态，这样做主要出于<em>可伸缩性</em>的考虑：如果服务端保存客户端的状态，就会需要大量存储空间，而影响服务器的性能；另一方面，无状态约束使得服务器的变化对客户端不可见。<br>REST的设计准则：</p><ul><li>所有事物都被抽象为资源，每个资源对应唯一标识符</li><li>通过标准的方法(CRUD)对资源进行操作</li><li>所有操作都是无状态的，对资源的各种操作不会改变资源标识符</li><li>分层的原则，组件无法了解到它与之交互的中间件之外的组件</li></ul><p>REST是对HTTP协议的全新诠释。它从资源的角度来考察整个网络，分布在各处资源由URI确定，客户端通过这些URI来获取这些资源的表征，并改变了这些资源的状态，即所谓的表征状态转移(Representational State Transfer)。REST同样实现了Web Service的平台独立、松耦合、互操作性的目标，除此之外，REST更轻量级、更简单。<br>从基本原理上来看，REST是面向资源的，而WSDL/SOAP是面向活动的。举例来说，我们想获得某个城市的天气，REST可以通过<code>GET</code>方式获取到想要的信息，而WSDL/SOAP则会通过调用远程主机的<code>getCityWeather()</code>来获取。</p><h4 id="SOA"><a href="#SOA" class="headerlink" title="SOA"></a>SOA</h4><p>面向服务的体系结构(SOA, Service-Oriented Architecture)是一个组件模型。它通过定义良好的<em>接口</em>和<em>契约</em>，将应用程序的不同功能单元（即服务）联系起来。<em>接口</em>是采用中立的方式进行定义的，它应该独立于实现服务的硬件平台、操作系统和编程语言。这使得构建在各种各样的系统中的服务可以使用一种统一和通用的方式进行交互。<br>通过SOA，松散耦合的、粗粒度的应用组件可以根据需求进行分布式的部署、组合和使用；应用和服务之间通过简单、精确定义接口进行通讯，不涉及底层编程接口和通讯模型。</p><p>至于SOA和Web Service的两者关系，SOA是一种架构模式，Web Service是利用一组标准实现的服务。</p><h2 id="COMMENT"><a href="#COMMENT" class="headerlink" title="COMMENT"></a>COMMENT</h2><p>中间件，乱的可以。一点看不清脉络:(<br><br>[CC BY-SA 3.0]: <a href="http://creativecommons.org/licenses/by-sa/3.0" target="_blank" rel="noopener">http://creativecommons.org/licenses/by-sa/3.0</a> “CC BY-SA 3.0”<br>[GFDL]: <a href="http://www.gnu.org/copyleft/fdl.html" target="_blank" rel="noopener">http://www.gnu.org/copyleft/fdl.html</a> “GFDL”</p></div><div><ul class="post-copyright"><li class="post-copyright-author"><strong>本文作者：</strong> WrRan</li><li class="post-copyright-link"><strong>本文链接：</strong> <a href="http://47.110.235.226/blog/2016/06/06/review/middleware/" title="中间件复习">http://47.110.235.226/blog/2016/06/06/review/middleware/</a></li><li class="post-copyright-license"><strong>版权声明： </strong>本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/3.0/" rel="external nofollow" target="_blank">CC BY-NC-SA 3.0</a> 许可协议。转载请注明出处！</li></ul></div><footer class="post-footer"><div class="post-nav"><div class="post-nav-next post-nav-item"><a href="/blog/2016/05/31/review/it-project-management/" rel="next" title="IT项目管理复习"><i class="fa fa-chevron-left"></i> IT项目管理复习</a></div><span class="post-nav-divider"></span><div class="post-nav-prev post-nav-item"><a href="/blog/2016/06/07/review/bigdata/" rel="prev" title="大数据复习">大数据复习 <i class="fa fa-chevron-right"></i></a></div></div></footer></div></article><div class="post-spread"></div></div></div><div class="comments" id="comments"><div id="lv-container" data-id="city" data-uid="MTAyMC8zMjQ4OC85MDQ5"></div></div></div><div class="sidebar-toggle"><div class="sidebar-toggle-line-wrap"><span class="sidebar-toggle-line sidebar-toggle-line-first"></span> <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span> <span class="sidebar-toggle-line sidebar-toggle-line-last"></span></div></div><aside id="sidebar" class="sidebar"><div class="sidebar-inner"><ul class="sidebar-nav motion-element"><li class="sidebar-nav-toc sidebar-nav-active" data-target="post-toc-wrap">文章目录</li><li class="sidebar-nav-overview" data-target="site-overview">站点概览</li></ul><section class="site-overview sidebar-panel"><div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person"><img class="site-author-image" itemprop="image" src="/images/avatar.jpg" alt="WrRan"><p class="site-author-name" itemprop="name">WrRan</p><p class="site-description motion-element" itemprop="description"></p></div><nav class="site-state motion-element"><div class="site-state-item site-state-posts"><a href="/archives"><span class="site-state-item-count">247</span> <span class="site-state-item-name">日志</span></a></div><div class="site-state-item site-state-categories"><a href="/categories/index.html"><span class="site-state-item-count">77</span> <span class="site-state-item-name">分类</span></a></div><div class="site-state-item site-state-tags"><a href="/tags/index.html"><span class="site-state-item-count">121</span> <span class="site-state-item-name">标签</span></a></div></nav><div class="feed-link motion-element"><a href="/atom.xml" rel="alternate"><i class="fa fa-rss"></i> RSS</a></div><div class="links-of-author motion-element"><span class="links-of-author-item"><a href="https://github.com/WrRan" target="_blank" title="GitHub"><i class="fa fa-fw fa-github"></i> GitHub </a></span><span class="links-of-author-item"><a href="http://xtf615.com/" target="_blank" title="xuetf"><i class="fa fa-fw fa-globe"></i> xuetf</a></span></div></section><section class="post-toc-wrap motion-element sidebar-panel sidebar-panel-active"><div class="post-toc"><div class="post-toc-content"><ol class="nav"><li class="nav-item nav-level-2"><a class="nav-link" href="#复习要点"><span class="nav-number">1.</span> <span class="nav-text">复习要点</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#考试题型"><span class="nav-number">2.</span> <span class="nav-text">考试题型</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#REVIEW"><span class="nav-number">3.</span> <span class="nav-text">REVIEW</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#CH1-概述"><span class="nav-number">3.1.</span> <span class="nav-text">CH1 - 概述</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#中间件的背景及特点"><span class="nav-number">3.1.1.</span> <span class="nav-text">中间件的背景及特点</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#分布式系统"><span class="nav-number">3.1.2.</span> <span class="nav-text">分布式系统</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#中间件"><span class="nav-number">3.1.3.</span> <span class="nav-text">中间件</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#其他"><span class="nav-number">3.1.4.</span> <span class="nav-text">其他</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#CH2-分布式计算环境"><span class="nav-number">3.2.</span> <span class="nav-text">CH2 - 分布式计算环境</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#DCE"><span class="nav-number">3.2.1.</span> <span class="nav-text">DCE</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#CH3-ODP和CORBA介绍"><span class="nav-number">3.3.</span> <span class="nav-text">CH3 - ODP和CORBA介绍</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#ODP"><span class="nav-number">3.3.1.</span> <span class="nav-text">ODP</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#CORBA"><span class="nav-number">3.3.2.</span> <span class="nav-text">CORBA</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#CH4-远程过程调用RPC"><span class="nav-number">3.4.</span> <span class="nav-text">CH4 - 远程过程调用RPC</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#RPC"><span class="nav-number">3.4.1.</span> <span class="nav-text">RPC</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#RPC的Java实现"><span class="nav-number">3.4.2.</span> <span class="nav-text">RPC的Java实现</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#CH5-组件技术概述"><span class="nav-number">3.5.</span> <span class="nav-text">CH5 - 组件技术概述</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#组件的概念"><span class="nav-number">3.5.1.</span> <span class="nav-text">组件的概念</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#COM组件的定义和特点"><span class="nav-number">3.5.2.</span> <span class="nav-text">COM组件的定义和特点</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#CH6-Web服务器技术"><span class="nav-number">3.6.</span> <span class="nav-text">CH6 - Web服务器技术</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#Web服务器"><span class="nav-number">3.6.1.</span> <span class="nav-text">Web服务器</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#JavaEE"><span class="nav-number">3.6.2.</span> <span class="nav-text">JavaEE</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#EJB与Spring"><span class="nav-number">3.6.3.</span> <span class="nav-text">EJB与Spring</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#CH7-消息中间件"><span class="nav-number">3.7.</span> <span class="nav-text">CH7- 消息中间件</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#消息中间件的概念"><span class="nav-number">3.7.1.</span> <span class="nav-text">消息中间件的概念</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Java-Message-Service"><span class="nav-number">3.7.2.</span> <span class="nav-text">Java Message Service</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#CH8-数据存取中间件"><span class="nav-number">3.8.</span> <span class="nav-text">CH8 - 数据存取中间件</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#开放数据库连接"><span class="nav-number">3.8.1.</span> <span class="nav-text">开放数据库连接</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#JDBC"><span class="nav-number">3.8.2.</span> <span class="nav-text">JDBC</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#对象关系映射ORM"><span class="nav-number">3.8.3.</span> <span class="nav-text">对象关系映射ORM</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#JPA介绍"><span class="nav-number">3.8.4.</span> <span class="nav-text">JPA介绍</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#CH9-事务处理中间件"><span class="nav-number">3.9.</span> <span class="nav-text">CH9 - 事务处理中间件</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#事务"><span class="nav-number">3.9.1.</span> <span class="nav-text">事务</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#EJB事务体系结构"><span class="nav-number">3.9.2.</span> <span class="nav-text">EJB事务体系结构</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#CH10-Web服务"><span class="nav-number">3.10.</span> <span class="nav-text">CH10 - Web服务</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#Web-Service的概念"><span class="nav-number">3.10.1.</span> <span class="nav-text">Web Service的概念</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#REST"><span class="nav-number">3.10.2.</span> <span class="nav-text">REST</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#SOA"><span class="nav-number">3.10.3.</span> <span class="nav-text">SOA</span></a></li></ol></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#COMMENT"><span class="nav-number">4.</span> <span class="nav-text">COMMENT</span></a></li></ol></div></div></section></div></aside></div></main><footer id="footer" class="footer"><div class="footer-inner"><div class="copyright">&copy; 2016 - <span itemprop="copyrightYear">2020</span> <span class="with-love"><i class="fa fa-heart"></i> </span><span class="author" itemprop="copyrightHolder">WrRan</span></div><div class="powered-by">由 <a class="theme-link" href="https://hexo.io">Hexo</a> 强力驱动</div><div class="powered-by">Hosted by <a href="https://pages.coding.me" style="font-weight:700">Coding Pages</a></div><div class="theme-info">主题 - <a class="theme-link" href="https://github.com/iissnan/hexo-theme-next">NexT.Muse</a></div><div class="busuanzi-count"><script async src="https://dn-lbstatics.qbox.me/busuanzi/2.3/busuanzi.pure.mini.js"></script><span class="site-uv"><i class="fa fa-user"></i> <span class="busuanzi-value" id="busuanzi_value_site_uv"></span> </span><span class="site-pv"><i class="fa fa-eye"></i> <span class="busuanzi-value" id="busuanzi_value_site_pv"></span></span></div></div></footer><div class="back-to-top"><i class="fa fa-arrow-up"></i> <span id="scrollpercent"><span>0</span>%</span></div></div><script type="text/javascript">"[object Function]"!==Object.prototype.toString.call(window.Promise)&&(window.Promise=null)</script><script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script><script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script><script type="text/javascript" src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script><script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script><script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script><script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script><script type="text/javascript" src="/js/src/utils.js?v=5.1.2"></script><script type="text/javascript" src="/js/src/motion.js?v=5.1.2"></script><script type="text/javascript" src="/js/src/scrollspy.js?v=5.1.2"></script><script type="text/javascript" src="/js/src/post-details.js?v=5.1.2"></script><script type="text/javascript" src="/js/src/bootstrap.js?v=5.1.2"></script><script type="text/javascript">!function(e,t){var n,c=e.getElementsByTagName(t)[0];"function"!=typeof LivereTower&&((n=e.createElement(t)).src="https://cdn-city.livere.com/js/embed.dist.js",n.async=!0,c.parentNode.insertBefore(n,c))}(document,"script")</script><script type="text/javascript">// Popup Window;
    var isfetched = false;
    var isXml = true;
    // Search DB path;
    var search_path = "search.xml";
    if (search_path.length === 0) {
      search_path = "search.xml";
    } else if (/json$/i.test(search_path)) {
      isXml = false;
    }
    var path = "/" + search_path;
    // monitor main search box;

    var onPopupClose = function (e) {
      $('.popup').hide();
      $('#local-search-input').val('');
      $('.search-result-list').remove();
      $('#no-result').remove();
      $(".local-search-pop-overlay").remove();
      $('body').css('overflow', '');
    }

    function proceedsearch() {
      $("body")
        .append('<div class="search-popup-overlay local-search-pop-overlay"></div>')
        .css('overflow', 'hidden');
      $('.search-popup-overlay').click(onPopupClose);
      $('.popup').toggle();
      var $localSearchInput = $('#local-search-input');
      $localSearchInput.attr("autocapitalize", "none");
      $localSearchInput.attr("autocorrect", "off");
      $localSearchInput.focus();
    }

    // search function;
    var searchFunc = function(path, search_id, content_id) {
      'use strict';

      // start loading animation
      $("body")
        .append('<div class="search-popup-overlay local-search-pop-overlay">' +
          '<div id="search-loading-icon">' +
          '<i class="fa fa-spinner fa-pulse fa-5x fa-fw"></i>' +
          '</div>' +
          '</div>')
        .css('overflow', 'hidden');
      $("#search-loading-icon").css('margin', '20% auto 0 auto').css('text-align', 'center');

      $.ajax({
        url: path,
        dataType: isXml ? "xml" : "json",
        async: true,
        success: function(res) {
          // get the contents from search data
          isfetched = true;
          $('.popup').detach().appendTo('.header-inner');
          var datas = isXml ? $("entry", res).map(function() {
            return {
              title: $("title", this).text(),
              content: $("content",this).text(),
              url: $("url" , this).text()
            };
          }).get() : res;
          var input = document.getElementById(search_id);
          var resultContent = document.getElementById(content_id);
          var inputEventFunction = function() {
            var searchText = input.value.trim().toLowerCase();
            var keywords = searchText.split(/[\s\-]+/);
            if (keywords.length > 1) {
              keywords.push(searchText);
            }
            var resultItems = [];
            if (searchText.length > 0) {
              // perform local searching
              datas.forEach(function(data) {
                var isMatch = false;
                var hitCount = 0;
                var searchTextCount = 0;
                var title = data.title.trim();
                var titleInLowerCase = title.toLowerCase();
                var content = data.content.trim().replace(/<[^>]+>/g,"");
                var contentInLowerCase = content.toLowerCase();
                var articleUrl = decodeURIComponent(data.url);
                var indexOfTitle = [];
                var indexOfContent = [];
                // only match articles with not empty titles
                if(title != '') {
                  keywords.forEach(function(keyword) {
                    function getIndexByWord(word, text, caseSensitive) {
                      var wordLen = word.length;
                      if (wordLen === 0) {
                        return [];
                      }
                      var startPosition = 0, position = [], index = [];
                      if (!caseSensitive) {
                        text = text.toLowerCase();
                        word = word.toLowerCase();
                      }
                      while ((position = text.indexOf(word, startPosition)) > -1) {
                        index.push({position: position, word: word});
                        startPosition = position + wordLen;
                      }
                      return index;
                    }

                    indexOfTitle = indexOfTitle.concat(getIndexByWord(keyword, titleInLowerCase, false));
                    indexOfContent = indexOfContent.concat(getIndexByWord(keyword, contentInLowerCase, false));
                  });
                  if (indexOfTitle.length > 0 || indexOfContent.length > 0) {
                    isMatch = true;
                    hitCount = indexOfTitle.length + indexOfContent.length;
                  }
                }

                // show search results

                if (isMatch) {
                  // sort index by position of keyword

                  [indexOfTitle, indexOfContent].forEach(function (index) {
                    index.sort(function (itemLeft, itemRight) {
                      if (itemRight.position !== itemLeft.position) {
                        return itemRight.position - itemLeft.position;
                      } else {
                        return itemLeft.word.length - itemRight.word.length;
                      }
                    });
                  });

                  // merge hits into slices

                  function mergeIntoSlice(text, start, end, index) {
                    var item = index[index.length - 1];
                    var position = item.position;
                    var word = item.word;
                    var hits = [];
                    var searchTextCountInSlice = 0;
                    while (position + word.length <= end && index.length != 0) {
                      if (word === searchText) {
                        searchTextCountInSlice++;
                      }
                      hits.push({position: position, length: word.length});
                      var wordEnd = position + word.length;

                      // move to next position of hit

                      index.pop();
                      while (index.length != 0) {
                        item = index[index.length - 1];
                        position = item.position;
                        word = item.word;
                        if (wordEnd > position) {
                          index.pop();
                        } else {
                          break;
                        }
                      }
                    }
                    searchTextCount += searchTextCountInSlice;
                    return {
                      hits: hits,
                      start: start,
                      end: end,
                      searchTextCount: searchTextCountInSlice
                    };
                  }

                  var slicesOfTitle = [];
                  if (indexOfTitle.length != 0) {
                    slicesOfTitle.push(mergeIntoSlice(title, 0, title.length, indexOfTitle));
                  }

                  var slicesOfContent = [];
                  while (indexOfContent.length != 0) {
                    var item = indexOfContent[indexOfContent.length - 1];
                    var position = item.position;
                    var word = item.word;
                    // cut out 100 characters
                    var start = position - 20;
                    var end = position + 80;
                    if(start < 0){
                      start = 0;
                    }
                    if (end < position + word.length) {
                      end = position + word.length;
                    }
                    if(end > content.length){
                      end = content.length;
                    }
                    slicesOfContent.push(mergeIntoSlice(content, start, end, indexOfContent));
                  }

                  // sort slices in content by search text's count and hits' count

                  slicesOfContent.sort(function (sliceLeft, sliceRight) {
                    if (sliceLeft.searchTextCount !== sliceRight.searchTextCount) {
                      return sliceRight.searchTextCount - sliceLeft.searchTextCount;
                    } else if (sliceLeft.hits.length !== sliceRight.hits.length) {
                      return sliceRight.hits.length - sliceLeft.hits.length;
                    } else {
                      return sliceLeft.start - sliceRight.start;
                    }
                  });

                  // select top N slices in content

                  var upperBound = parseInt('1');
                  if (upperBound >= 0) {
                    slicesOfContent = slicesOfContent.slice(0, upperBound);
                  }

                  // highlight title and content

                  function highlightKeyword(text, slice) {
                    var result = '';
                    var prevEnd = slice.start;
                    slice.hits.forEach(function (hit) {
                      result += text.substring(prevEnd, hit.position);
                      var end = hit.position + hit.length;
                      result += '<b class="search-keyword">' + text.substring(hit.position, end) + '</b>';
                      prevEnd = end;
                    });
                    result += text.substring(prevEnd, slice.end);
                    return result;
                  }

                  var resultItem = '';

                  if (slicesOfTitle.length != 0) {
                    resultItem += "<li><a href='" + articleUrl + "' class='search-result-title'>" + highlightKeyword(title, slicesOfTitle[0]) + "</a>";
                  } else {
                    resultItem += "<li><a href='" + articleUrl + "' class='search-result-title'>" + title + "</a>";
                  }

                  slicesOfContent.forEach(function (slice) {
                    resultItem += "<a href='" + articleUrl + "'>" +
                      "<p class=\"search-result\">" + highlightKeyword(content, slice) +
                      "...</p>" + "</a>";
                  });

                  resultItem += "</li>";
                  resultItems.push({
                    item: resultItem,
                    searchTextCount: searchTextCount,
                    hitCount: hitCount,
                    id: resultItems.length
                  });
                }
              })
            };
            if (keywords.length === 1 && keywords[0] === "") {
              resultContent.innerHTML = '<div id="no-result"><i class="fa fa-search fa-5x" /></div>'
            } else if (resultItems.length === 0) {
              resultContent.innerHTML = '<div id="no-result"><i class="fa fa-frown-o fa-5x" /></div>'
            } else {
              resultItems.sort(function (resultLeft, resultRight) {
                if (resultLeft.searchTextCount !== resultRight.searchTextCount) {
                  return resultRight.searchTextCount - resultLeft.searchTextCount;
                } else if (resultLeft.hitCount !== resultRight.hitCount) {
                  return resultRight.hitCount - resultLeft.hitCount;
                } else {
                  return resultRight.id - resultLeft.id;
                }
              });
              var searchResultList = '<ul class=\"search-result-list\">';
              resultItems.forEach(function (result) {
                searchResultList += result.item;
              })
              searchResultList += "</ul>";
              resultContent.innerHTML = searchResultList;
            }
          }

          if ('auto' === 'auto') {
            input.addEventListener('input', inputEventFunction);
          } else {
            $('.search-icon').click(inputEventFunction);
            input.addEventListener('keypress', function (event) {
              if (event.keyCode === 13) {
                inputEventFunction();
              }
            });
          }

          // remove loading animation
          $(".local-search-pop-overlay").remove();
          $('body').css('overflow', '');

          proceedsearch();
        }
      });
    }

    // handle and trigger popup window;
    $('.popup-trigger').click(function(e) {
      e.stopPropagation();
      if (isfetched === false) {
        searchFunc(path, 'local-search-input', 'local-search-result');
      } else {
        proceedsearch();
      };
    });

    $('.popup-btn-close').click(onPopupClose);
    $('.popup').click(function(e){
      e.stopPropagation();
    });
    $(document).on('keyup', function (event) {
      var shouldDismissSearchPopup = event.which === 27 &&
        $('.search-popup').is(':visible');
      if (shouldDismissSearchPopup) {
        onPopupClose();
      }
    });</script><script>!function(){var t=document.createElement("script"),e=window.location.protocol.split(":")[0];t.src="https"===e?"https://zz.bdstatic.com/linksubmit/push.js":"http://push.zhanzhang.baidu.com/push.js";var s=document.getElementsByTagName("script")[0];s.parentNode.insertBefore(t,s)}()</script><script type="text/x-mathjax-config">MathJax.Hub.Config({
        tex2jax: {
          inlineMath: [ ['$','$'], ["\\(","\\)"]  ],
          processEscapes: true,
          skipTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code']
        }
      });</script><script type="text/x-mathjax-config">MathJax.Hub.Queue(function() {
        var all = MathJax.Hub.getAllJax(), i;
        for (i=0; i < all.length; i += 1) {
          all[i].SourceElement().parentNode.className += ' has-jax';
        }
      });</script><script type="text/javascript" src="//cdn.bootcss.com/mathjax/2.7.1/latest.js?config=TeX-AMS-MML_HTMLorMML"></script></body></html>